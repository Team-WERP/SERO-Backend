<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.werp.sero.employee.query.dao.EmployeeMapper">

    <!-- Employee ResultMap -->
    <resultMap id="employeeResultMap" type="com.werp.sero.employee.command.domain.aggregate.Employee">
        <id property="id" column="id"/>
        <result property="empCode" column="emp_code"/>
        <result property="email" column="email"/>
        <result property="password" column="password"/>
        <result property="name" column="name"/>
        <result property="contact" column="contact"/>
        <result property="status" column="status"/>
        <result property="positionCode" column="position_code"/>
        <result property="rankCode" column="rank_code"/>
        <result property="startDate" column="start_date"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <!-- Employee with Department ResultMap -->
    <resultMap id="employeeWithDepartmentResultMap" type="com.werp.sero.employee.command.domain.aggregate.Employee">
        <id property="id" column="id"/>
        <result property="empCode" column="emp_code"/>
        <result property="email" column="email"/>
        <result property="password" column="password"/>
        <result property="name" column="name"/>
        <result property="contact" column="contact"/>
        <result property="status" column="status"/>
        <result property="positionCode" column="position_code"/>
        <result property="rankCode" column="rank_code"/>
        <result property="startDate" column="start_date"/>
        <result property="createdAt" column="created_at"/>
        <association property="department" javaType="com.werp.sero.employee.command.domain.aggregate.Department">
            <id property="id" column="dept_id"/>
            <result property="deptName" column="dept_name"/>
            <result property="deptCode" column="dept_code"/>
        </association>
    </resultMap>

    <!-- 부서별 사원 목록 조회 (부서 정보 포함) -->
    <select id="findByDepartmentIdWithDepartment" resultMap="employeeWithDepartmentResultMap">
        SELECT
            A.id,
            A.emp_code,
            A.email,
            A.password,
            A.name,
            A.contact,
            A.status,
            A.position_code,
            A.rank_code,
            A.start_date,
            A.created_at,
            B.id AS dept_id,
            B.dept_name AS dept_name,
            B.dept_code AS dept_code
        FROM employee A
        INNER JOIN department B ON A.dept_id = B.id
        WHERE A.dept_id = #{departmentId}
        ORDER BY A.id
    </select>

    <!-- 전체 사원 목록 조회 (부서 정보 포함) -->
    <select id="findAllWithDepartment" resultMap="employeeWithDepartmentResultMap">
        SELECT
            A.id,
            A.emp_code,
            A.email,
            A.password,
            A.name,
            A.contact,
            A.status,
            A.position_code,
            A.rank_code,
            A.start_date,
            A.created_at,
            B.id AS dept_id,
            B.dept_name AS dept_name,
            B.dept_code AS dept_code
        FROM employee A
        LEFT JOIN department B ON A.dept_id = B.id
        ORDER BY A.id
    </select>

    <!-- ID로 직원 조회 -->
    <select id="findById" resultMap="employeeResultMap">
        SELECT
            A.id,
            A.emp_code,
            A.email,
            A.password,
            A.name,
            A.contact,
            A.status,
            A.position_code,
            A.rank_code,
            A.start_date,
            A.created_at
        FROM employee A
        WHERE A.id = #{id}
    </select>

</mapper>
