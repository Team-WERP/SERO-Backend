<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.werp.sero.warehouse.query.dao.WarehouseStockHistoryMapper">

    <resultMap id="warehouseStockHistoryResultMap" type="com.werp.sero.warehouse.command.domain.aggregate.WarehouseStockHistory">
        <id property="id" column="id"/>
        <result property="warehouseStockId" column="warehouse_stock_id"/>
        <result property="type" column="type"/>
        <result property="reason" column="reason"/>
        <result property="changedQuantity" column="changed_quantity"/>
        <result property="currentStock" column="current_stock"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <!-- Find stock history by warehouse stock ID -->
    <select id="findByWarehouseStockId" resultMap="warehouseStockHistoryResultMap">
        SELECT
            A.id,
            A.warehouse_stock_id,
            A.type,
            A.reason,
            A.changed_quantity,
            A.current_stock,
            A.created_at
        FROM warehouse_stock_history A
        WHERE A.warehouse_stock_id = #{warehouseStockId}
        ORDER BY A.created_at DESC
    </select>

    <!-- Find stock history with conditions -->
    <select id="findByCondition" resultMap="warehouseStockHistoryResultMap">
        SELECT
            A.id,
            A.warehouse_stock_id,
            A.type,
            A.reason,
            A.changed_quantity,
            A.current_stock,
            A.created_at
        FROM warehouse_stock_history A
        <where>
            <if test="warehouseStockId != null">
                AND A.warehouse_stock_id = #{warehouseStockId}
            </if>
            <if test="type != null and type != ''">
                AND A.type = #{type}
            </if>
            <if test="startDate != null">
                AND A.created_at &gt;= #{startDate}
            </if>
            <if test="endDate != null">
                AND A.created_at &lt;= #{endDate}
            </if>
        </where>
        ORDER BY A.created_at DESC
    </select>

</mapper>
